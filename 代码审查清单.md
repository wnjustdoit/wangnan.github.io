# 代码审查清单

代码审查是指对源代码进行系统审查，以找出并修正在软件开发初期未发现的错误，提升软件的质量。相比静态代码扫描，代码审查主要借助开发者之间的相互阅读及代码审查，来发现代码中的BUG等问题 

## 原则

### 1. 要有审查清单

代码审查可以标准化和流程化，在一定程度上也可以量化，有一份审查清单是非常有必要，这样大家都有了一个标准，在代码审查过程中按照审查清单逐一检查，帮助审查者快速找到问题，甚至开发者在开发阶段就可以按照审查清单进行代码自查。

一般情况下，代码审查清单应包括以下几大内容

- 代码结构： 是否有超长代码，代码层次嵌套是否过深；方法参数是否过多；
- 代码安全性： I/O流是否正常关闭，资金计算是否使用了Double类型，是否有超大的临时对象，线程池大小是否合理，异常是否被忽略，是否有日志记录，是否存在并发问题，参数是否做了必要的检查
- 代码性能：是否有超长SQL，是否有成熟类库可以替换自己实现的代码，是否可以考虑线程池
- 代码注释：注释是否可以准确表达含义，是否存在fixme/todo注释，是否包括边界值及对异常情况的说明
- 单元测试：代码是否有可测试性，新代码是否有单元测试，单元测试是否可以覆盖所有场景

### 2. 关注改动点

通过代码审查工具，使清楚地看出代码有哪些改动点（包括新增的代码），通过对照事先置顶的审核清单，重点关注动点是一种比较高效方法。

但是，重点关注改动点并不只是关注改动点，其实，还有很多问题隐藏在非改动点处。这就需要审查者通读改动点附近的全部代码，可以更好地发现问题，尤其是和业务逻辑相关的问题。

### 3. 代码审查应是日常性工作

最好的实践是在每次提交改动较大的代码后，进行代码审。这样可以更早地发现问题，也可以使其他人更早地了解这部分新代码。如果等到项目即将发布才集中进行代码审查，就会有很多问题，会有很多代码需要审查，导致审查人员过于疲劳，无法集中精力审查代码，并忽略一些问题。而且，在项目即将发布时进行代码审查，即使在代码审查中发现一些问题，也不便于修改。

ps: 过于理想化，先当做追求目标吧。

### 4. 一次审查代码不要太多。
400行。有利于审查者集中精力，最好每天抽出固定的一段时间，来集中精力对少部分代码做代码审查。

### 5. 一次审查时间不要太长
不要超过60分钟

## 审查清单

|检查分类|检查项目|其他说明|
|---|---|---|
|sonar|BUG，漏洞，坏味道|借助工具进行静态代码检查|
|代码规范|命名规范；常量魔法值；代码格式；异常处理；长SQL| |
| |注释：是否合理且准确表达含义；边界值描述是否准确；是否有fixme/todo注释| |
| |日志：合理的日志级别；避免重复打印；是否便于线上排查问题；禁止System.out日志| |
| |util类是否有可替代的成熟类| |
|接口规范|rest风格；命名规范| |
|代码性能|是否可以考虑线程池；线程池大小是否合理| |
|代码安全|接口权限鉴权| |
| |业务数据隔离。如A卖家登录不能查到B卖家数据| |
| |是否存在超大的临时对象| |
| |I/O是否正常关闭| |
| |线程安全，是否有并发问题| |
| |SQL注入| |
| |关键资源防重机制，如发短信，下单| |
| |敏感数据，不写日志等等| |
|单元测试|覆盖率，单元测试是否可以覆盖所有场景；测试用例通过率| |
| |测试用例不产生副作用，赃数据| |
| |自动化测试，assert自动验证，禁止System.out/log日志人为验证| |






